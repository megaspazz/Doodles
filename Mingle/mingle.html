<!DOCTYPE html>
<html>
    <head>
        <title>Mingle - Word Game</title>
    </head>
    <body>
        <h1>M _ N G L E</h1>
        <h6>version 0.0.2</h6>
        <div style="font-family: Helvetica, sans-serif;">
            <h2>Instructions</h2>
            <ul>
                <li>Try to guess the missing letters.</li>
                <li>The missing letters are the same in all words.</li>
                <li>You only get <strong>ONE</strong> guess, so guess wisely.</li>
                <li>Press the Enter key to submit your guess.</li>
                <li>Click "Next Hint" to get another clue.</li>
                <li>Refresh the page to play another puzzle.</li>
            </ul>
        </div>
        <div id="divInput">
            <div>
                <label for="txtInput" style="font-family: Helvetica, sans-serif;"><strong>FINAL</strong> GUESS</label>
                <input id="txtInput" type="text" autofocus></input>
            </div>
            <input id="btnHint" type="button" value="Next Hint"></input>
        </div>
        <div id="divHints" style="font-family: monospace; white-space: pre-wrap; margin: 12px;"></div>
        <div id="divWinBanner" style="font-family: Helvetica, sans-serif; font-size: x-large; white-space: pre-wrap;"></div>
        <div id="divResult" style="white-space: pre-wrap;"></div>

        <script src="game.js"></script>
        <script src="hint.js"></script>
        <script src="log.js"></script>
        <script src="render.js"></script>
        <script src="words.js"></script>
        <script>
            let game;
            let render;

            window.onload = function() {
                Log.write("start");

                game = Game.generate(g => {
                    return g.hints.length >= 3;
                });
                game.shuffleHints();
                // Coarsely sort by difficulty of hint.
                // const score = (hint) => {
                //     const before = hint.offset;
                //     const after = hint.word.length - hint.offsetEnd();
                //     return (before + 1) * (after + 1);
                // };
                // game.hints.sort((a, b) => {
                //     return score(a) - score(b);
                // });
                Log.write(game);

                const divHints = document.getElementById("divHints");
                const divWinBanner = document.getElementById("divWinBanner");
                const divResult = document.getElementById("divResult");
                render = new Render(divHints, divWinBanner, divResult);
                Log.write("render ready");

                const txtInput = document.getElementById("txtInput");
                txtInput.onkeydown = handleInput;

                const btnHint = document.getElementById("btnHint");
                btnHint.onclick = nextHint;
                
                Log.write("events ready");

                nextHint();
                render.drawHints(game);

                Log.write(document.getElementsByTagName("html")[0].innerHTML);
            }

            function handleInput(e) {
                if (e.key === "Enter") {
                    const txtInput = document.getElementById("txtInput");
                    const divInput = document.getElementById("divInput");
                    const divResult = document.getElementById("divResult");
                    const btnHint = document.getElementById("btnHint");
                    const guess = txtInput.value.toUpperCase();
                    render.drawResult(game, guess);
                    txtInput.disabled = true;
                    btnHint.disabled = true;
                    
                }
            }

            function nextHint() {
                ++game.hintsUsed;
                if (game.hintsUsed >= game.hints.length) {
                    const btnHint = document.getElementById("btnHint");
                    btnHint.disabled = true;
                }
                render.drawHints(game);
                focusInput();
            }

            function focusInput() {
                const txtInput = document.getElementById("txtInput");
                txtInput.focus();
            }
        </script>
    </body>
</html>